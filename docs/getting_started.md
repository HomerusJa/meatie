# Getting Started

This guide will walk you through creating your first API client with Meatie.
For a general overview of Meatie and its features, see the
[home page](./index.md).

## Installation

For this guide, we will use the `httpx` library as the HTTP client. We will
also use the `pydantic` library for defining the data models. To install the
required libraries, run the following command:

```bash
pip install meatie[httpx] pydantic
```

Using the `[httpx]` extra will install the `httpx` backend for Meatie. This
ensures the compatibility between `meatie` and the specific version of `httpx`.

If you want to learn how to use Meatie with different HTTP clients, check out the [Backends section](./backends/overview.md).

## Quick Start

We will create a simple client for the
[JSONPlaceholder](https://jsonplaceholder.typicode.com/) API. We will use it to
get some posts. First, we need to define a pydantic model for the post. The
JSONPlaceholder API returns the following JSON object for a post:

```json
{
  "userId": 1,
  "id": 1,
  "title": "sunt aut facere repellat provident occaecati excepturi optio reprehenderit",
  "body": "quia et suscipit\nsuscipit recusandae consequuntur expedita et cum\nreprehenderit molestiae ut ut quas totam\nnostrum rerum est autem sunt rem eveniet architecto"
}
```

Using this information, we can define the `Post` model:

```python
from pydantic import BaseModel

class Post(BaseModel):
    userId: int
    id: int
    title: str
    body: str
```

Next, we will create the client for the JSONPlaceholder API. As mentioned
above, we will use the `httpx` library as a backend. Let's create the
boilerplate to define a client:

```python
import httpx
from meatie import endpoint
from meatie_httpx import Client

class JsonPlaceholderClient(Client):
    def __init__(self) -> None:
        super().__init__(httpx.Client(base_url="https://jsonplaceholder.typicode.com"))
```

Now, defining the endpoints is straightforward. We will create a method to get
a post by number:

```python
    @endpoint("/posts/{post_id}")
    def get_post(self, post_id: int) -> Post: ...
```

Note that we are using the ellipsis (`...`) as a placeholder for the method.
The content of this method will be generated by Meatie, so any content here
will be ignored.

For defining the endpoint, we use the `@endpoint` decorator. The decorator
takes the URL pattern as an argument, which works heavily like FastAPI's path
definitions. The REST method is inferred from the method signature. If you want
to specify the method explicitly, you can use the `method` argument of the
decorator.

That's it! We have defined a client for the JSONPlaceholder API. We can now use
it to get a post by its number:

```python
with JsonPlaceholderClient() as client:
    post = client.get_post(1)
    print(post)
```

Using the client in a `with` block ensures that the client is properly closed
after the block is executed, preventing any resource leaks.

Let's add another endpoint to the client to get all posts:

```python
    @endpoint("/posts")
    def get_posts(self) -> list[Post]: ...
```

Now, we can get all posts using the following code:

```python
with JsonPlaceholderClient() as client:
    posts: list[Post] = client.get_posts()
    for post in posts:
        print(post)
```

Let's finish the client by adding a method to create a new post. For that, we need to create some new models:

```python
class PostCreate(BaseModel):
    userId: int
    title: str
    body: str

class PostCreateResponse(BaseModel):
    id: int
```

Now, we can add the method to the client:

```python
    @endpoint("/posts", method="POST")
    def create_post(self, post: PostCreate) -> PostCreateResponse: ...
```

Following is the full code for the client:

```python
import httpx
from meatie import endpoint
from meatie_httpx import Client
from pydantic import BaseModel

class Post(BaseModel):
    userId: int
    id: int
    title: str
    body: str

class PostCreate(BaseModel):
    userId: int
    title: str
    body: str

class PostCreateResponse(BaseModel):
    id: int

class JsonPlaceholderClient(Client):
    def __init__(self) -> None:
        super().__init__(httpx.Client(base_url="https://jsonplaceholder.typicode.com"))

    @endpoint("/posts/{post_id}")
    def get_post(self, post_id: int) -> Post: ...

    @endpoint("/posts")
    def get_posts(self) -> list[Post]: ...

    @endpoint("/posts", method="POST")
    def create_post(self, post: PostCreate) -> PostCreateResponse: ...

with JsonPlaceholderClient() as client:
    post = client.get_post(1)
    print(post)
    print("-" * 80)
    posts = client.get_posts()
    for post in posts[:10]:
        print(post)
    print("-" * 80)
    post_id = client.create_post(PostCreate(userId=1, title="New Post", body="This is a new post."))
    print(post_id)
```

## Further Reading

That concludes the quick start guide. If you want to dive deeper into Meatie,
check out the [advanced topics](./advanced/overview.md) section. If you have
any questions or need help, feel free to ask on the
[GitHub Discussions](https://github.com/pmateusz/meatie/discussions) page.
